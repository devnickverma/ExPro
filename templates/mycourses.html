{% extends "base.html" %}

{% block title %}My Courses - My Website{% endblock %}

{% block content %}
    <div class="container mt-5">
        <h1>Enrolled Courses</h1>
        
        <!-- Container to display courses -->
        <div id="courses-list">
            <p>Loading courses...</p>
        </div>
    </div>
{% endblock %}

{% block load_js %}
<script>
    // Function to fetch and display courses
    async function fetchCourses() {
        try {
            const token = localStorage.getItem('token'); // Get the token from localStorage
            console.log("Token:", token);
            const response = await fetch('/users/enroll_courses', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`,
                }
            });



            if (!response.ok) {
                throw new Error(`Error: ${response.statusText}`);
            }

            const courses = await response.json();
            console.log('Courses fetched:', courses);
            
            const coursesListDiv = document.getElementById('courses-list');
            coursesListDiv.innerHTML = ''; // Clear the loading message

            if (courses.length === 0) {
                coursesListDiv.innerHTML = '<p>No enrolled courses found.</p>';
            } else {
                console.log(courses)
                const coursesHTML = courses.map(course => {
                    return `
                        <div class="course mb-4 p-3 border">
                            <h4>${course.title}</h4>
                            <p> ${course.description}</p>
                        </div>
                    `;
                }).join('');
                
                coursesListDiv.innerHTML = coursesHTML;
            }

        } catch (error) {
            console.error('Error fetching courses:', error);
            document.getElementById('courses-list').innerHTML = '<p>Error loading courses. Please try again later.</p>';
        }
    }

    
    // Function to check login status on page load
    function checkLoginStatus() {
        const token = localStorage.getItem('token'); // Get the token from localStorage

        if (!token) {
            console.log('User is not logged in');
            // Redirect to the login page if no token is found
            window.location.href = '/login'; // Change the URL if your login page is at a different path
        } else {
            console.log('User is logged in');
            // Optionally, you can add logic to fetch user-specific data or show additional content
        }
    }

    // Combine both functions into one window.onload handler
    window.onload = function() {
        checkLoginStatus(); // First check the login status
        fetchCourses();     // Then fetch the courses
    };
</script>
{% endblock %}
